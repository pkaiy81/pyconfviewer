<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Configuration Viewer</title>
    <!-- CSS dependencies -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css">
    <!-- jsTree CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.12/themes/default/style.min.css">
    <!-- Custom styles -->
    <style>
        /* Add custom styles here */
    </style>
</head>
<body>
    <div class="container-fluid">
        <h1 class="mt-4">Configuration Viewer</h1>
        <!-- Search box -->
        <input type="text" id="search-input" class="form-control mb-3" placeholder="Search...">
        <!-- Tabs -->
        <ul class="nav nav-tabs" id="configTabs" role="tablist">
            <!-- Tabs will be generated dynamically here -->
        </ul>
        <!-- Tab content -->
        <div class="tab-content" id="configTabsContent">
            <!-- Tab content will be generated dynamically here -->
        </div>
    </div>

    <!-- JavaScript dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jsTree JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.12/jstree.min.js"></script>
    <!-- Custom scripts -->
    <script>
        // Fetch the external JSON file
        fetch('/static/json/configs.json')
            .then(response => response.json())
            .then(configsData => {
                // Dynamically generate tabs and tab content based on the fetched configs data
                var tabList = $('#configTabs');
                var tabContent = $('#configTabsContent');
                Object.keys(configsData).forEach(function(filename, index) {
                    // Generate tab
                    var isActive = index === 0 ? 'active' : '';
                    var tabItem = `
                        <li class="nav-item">
                            <a class="nav-link ${isActive}" id="tab-${index}-tab" data-toggle="tab" href="#tab-${index}" role="tab">${filename}</a>
                        </li>
                    `;
                    tabList.append(tabItem);

                    // Generate tab content
                    var tabPane = `
                        <div class="tab-pane fade ${isActive ? 'show active' : ''}" id="tab-${index}" role="tabpanel">
                            <div id="treeview-${index}" class="treeview"></div>
                        </div>
                    `;
                    tabContent.append(tabPane);

                    // Initialize jsTree for this tab's content
                    $(`#treeview-${index}`).jstree({
                        'core' : {
                            'data' : buildTree(configsData[filename])
                        },
                        'plugins' : ['search']
                    });
                });

                // Search functionality
                var to = false;
                $('#search-input').keyup(function () {
                    if(to) { clearTimeout(to); }
                    to = setTimeout(function () {
                        var v = $('#search-input').val();
                        $('.treeview').jstree(true).search(v);
                    }, 250);
                });
            })
            .catch(error => console.error('Error loading configs:', error));

        // Function to build tree structure from config data
        function buildTree(obj) {
            var result = [];
            for (var key in obj) {
                if (typeof obj[key] === 'object' && obj[key] !== null) {
                    result.push({
                        'text': key,
                        'children': buildTree(obj[key])
                    });
                } else {
                    result.push({
                        'text': key + ': ' + obj[key]
                    });
                }
            }
            return result;
        }
    </script>
</body>
</html>
